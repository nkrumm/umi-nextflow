manifest {
    homePage = 'https://gitlab.labmed.uw.edu/genetics/umi_nextflow'
    description = 'UMI pipeline written in nextflow.'
    version = '0.1'
    name = 'umi-nextflow'
}

profiles {
  uw_batch {
      params {
        input_folder = 's3://uwlm-personal/nkrumm/umi/fastq/280R/'
        run_id = "280R"
        output = "s3://uwlm-personal/nkrumm/umi/out/"
        // reference files
        picard_bed = "s3://uwlm-personal/nkrumm/umi/reference/MONC_ctDNA1.3_designed_probe_coords_180314_no_chr.interval_list"
        bed = "s3://uwlm-personal/nkrumm/umi/reference/MONC_ctDNA1.3_designed_probe_coords_180314_no_chr.bed"
        ref_fasta = "s3://uwlm-personal/nkrumm/references/hs37.fa"
        ref_index = "s3://uwlm-personal/nkrumm/references/hs37.fa.{amb,ann,bwt,pac,sa,dict,fai}"
      }
      workDir = 's3://uwlm-nextflow-data/workdir/umi-nextflow'
      process {
          scratch = "/docker_scratch"
          queue = 'ngs-queue'
          executor = 'awsbatch'

          withLabel:bwa {
            container = 'nkrumm/alignment'
            cpus = 30
            memory = "60GB"
          }
          withLabel:fgbio{
            container = 'quay.io/biocontainers/fgbio:1.1.0--0'
          }
          withLabel:picard{
            container = 'quay.io/biocontainers/picard:2.9.2--py35_1'
          }
          withLabel:vardict{
            container = 'quay.io/biocontainers/vardict:1.7.0--0'
          }
      }
      aws {
          region = 'us-west-2'
          batch {
              volumes = '/docker_scratch'
              cliPath = '/home/ec2-user/miniconda/bin/aws'
          }
      }
  }

  singularity {
    params {   
        // Input folder needs trailing slash
        input_folder = '/mnt/disk1/genetics/TGC/fastqs/200213_NB0357_MiniOncoKAPA280R-MONCv1/'
        picard_bed = '/mnt/disk2/com/Genomes/Picard/MONC_ctDNA1.3_designed_probe_coords_180314_no_chr.Picard.bed'
        ref_fasta = '/mnt/disk2/com/Genomes/gatk-bundle/human_g1k_v37.fasta'
        ref_index = '/mnt/disk2/com/Genomes/gatk-bundle/human_g1k_v37.fasta.{amb,ann,bwt,pac,sa,dict,fai}'
        bed = '/mnt/disk2/com/Genomes/BED_Files/MONC_ctDNA1.3_designed_probe_coords_180314_no_chr.bed'
        workDir = '/mnt/disk10/users/sheenams/umi_nextflow/'
        output = 'output'
    }
    
    process.executor = 'local'
    queueSize = 10
    max_cpus = 32
    max_memory = 128.GB
    docker.enabled = false
    singularity.autoMounts = true //When true Nextflow automatically mounts host paths in the executed contained. 
    singularity.enabled = true  // Turn this flag to true to enable Singularity executio
    process {
        withLabel:bwa {
          container = 'file:///mnt/disk2/com/container-images/bwa-0.7.17.simg'
          cpus = 8
        }
        withLabel:fgbio{
          container = 'file:///mnt/disk2/com/container-images/fgbio-1.1.0.simg'
        }
        withLabel:picard{
          container = 'file:///mnt/disk2/com/container-images/picard-2.18.16.simg'
        }
        withLabel:vardict{
          container = 'file:///mnt/disk2/com/container-images/vardict-1.5.1.simg'
        }
    }
  }
}